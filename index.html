<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no" />
    <title>Task Garden</title>
    <style>
        :root {
            --bg: #020617;
            --card: rgba(30, 41, 59, 0.4);
            --muted: #94a3b8;
            --accent: #38bdf8;
            --green: #4ade80;
            --yellow: #facc15; 
            --red: #ef4444;
            --border: rgba(255, 255, 255, 0.1);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        html, body { 
            margin: 0; padding: 0; height: 100vh; width: 100%; 
            background: var(--bg); color: #fff;
            font-family: -apple-system, system-ui, sans-serif;
            overflow: hidden;
            height: -webkit-fill-available;
        }

        body { background: radial-gradient(circle at top right, #0f172a, #020617); }

        /* Splash Screen */
        #splash-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--bg);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            z-index: 2000; 
            transition: opacity 0.8s ease, visibility 0.8s;
            padding: 2.5rem; text-align: center;
        }
        #splash-quote {
            font-size: 1.1rem; font-weight: 300; font-style: italic; line-height: 1.6;
            max-width: 600px; color: #fff; margin-bottom: 20px;
            opacity: 0; transform: translateY(10px); animation: fadeInUp 1.5s forwards 0.2s;
        }
        #splash-author { font-size: 0.8rem; color: var(--accent); opacity: 0; animation: fadeInUp 0.8s forwards 0.5s; letter-spacing: 1px; text-transform: uppercase; }
        
        @keyframes fadeInUp { to { opacity: 1; transform: translateY(0); } }
        .hidden { opacity: 0; visibility: hidden; pointer-events: none; }

        /* Navigation */
        .nav-dots {
            position: fixed; bottom: calc(env(safe-area-inset-bottom) + 20px);
            left: 50%; transform: translateX(-50%); display: flex; gap: 12px; z-index: 100;
        }
        .dot { width: 6px; height: 6px; border-radius: 50%; background: rgba(255, 255, 255, 0.2); transition: 0.3s; }
        .dot.active { background: var(--accent); transform: scale(1.5); }

        #screen-container { display: flex; width: 400%; height: 100%; transition: transform 0.5s cubic-bezier(0.16, 1, 0.3, 1); }

        .view { 
            width: 25%; height: 100%; overflow-y: auto; padding: 1.2rem; 
            padding-top: calc(env(safe-area-inset-top) + 20px); padding-bottom: 200px;
        }

        /* Task Cards */
        .task-card {
            background: var(--card); backdrop-filter: blur(12px);
            border-radius: 16px; padding: 0.6rem 0.8rem; margin-bottom: 0.6rem;
            border: 1px solid var(--border); transition: 0.3s;
            display: flex; align-items: center; gap: 10px;
        }
        .ping-flash { background: rgba(74, 222, 128, 0.3) !important; border-color: var(--green) !important; transform: scale(1.02); }
        
        .growth-stage-icon { font-size: 1.6rem; cursor: pointer; flex-shrink: 0; display: flex; align-items: center; }
        
        .task-main { flex: 1; min-width: 0; overflow: hidden; }
        .task-name { font-weight: 500; font-size: 0.95rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .harvest-meta { font-size: 0.7rem; color: var(--green); margin-top: -2px; }

        .growth-controls { display: flex; align-items: center; gap: 6px; flex-shrink: 0; }
        .percent-badge { font-weight: 800; color: var(--accent); font-size: 0.8rem; min-width: 35px; text-align: center; }
        
        .step-btn {
            background: rgba(255,255,255,0.08); border: none; color: #fff;
            width: 28px; height: 28px; border-radius: 8px; font-size: 1.1rem; cursor: pointer;
            display: flex; align-items: center; justify-content: center;
        }
        .step-btn:disabled { opacity: 0.1; pointer-events: none; }
        
        .del-btn { background: none; border: none; color: var(--red); font-size: 1.4rem; cursor: pointer; padding: 0 4px; line-height: 1; opacity: 0.4; }
        .del-btn:hover { opacity: 1; }

        .input-bar { position: fixed; bottom: calc(env(safe-area-inset-bottom) + 70px); left: 1.2rem; right: 1.2rem; z-index: 10; }
        .input-box { background: rgba(15, 23, 42, 0.95); border-radius: 18px; padding: 8px 12px; display: flex; gap: 8px; border: 1px solid var(--border); }
        input[type="text"] { background: none; border: none; color: #fff; flex: 1; outline: none; font-size: 1rem; }
        
        .sound-toggle { margin-bottom: 10px; padding: 10px; background: var(--card); border-radius: 10px; cursor: pointer; border: 1px solid var(--border); transition: 0.2s; }
        .sound-toggle.active { border-color: var(--accent); background: rgba(56, 189, 248, 0.1); }
        
        .archive-toolbar { display: flex; flex-direction: column; gap: 8px; margin-bottom: 20px; }
        .tool-btn { background: rgba(56, 189, 248, 0.1); border: 1px solid var(--accent); color: var(--accent); padding: 10px; border-radius: 10px; font-size: 0.8rem; font-weight: bold; cursor: pointer; text-align: center; }
        .tool-btn-secondary { background: none; border: 1px solid var(--border); color: var(--muted); padding: 10px; border-radius: 10px; font-size: 0.8rem; text-align: center; cursor: pointer; }
    </style>
</head>
<body>

<div id="splash-screen">
    <div id="splash-quote">"Focusing your mind..."</div>
    <div id="splash-author"></div>
</div>

<div class="nav-dots">
    <div class="dot"></div><div class="dot active"></div><div class="dot"></div><div class="dot"></div>
</div>

<div id="screen-container">
    <div class="view">
        <h2 style="color: var(--accent); margin-top:0;">Mindful Space</h2>
        <div style="display: flex; gap: 8px; margin-bottom: 20px;">
            <div class="sound-toggle" id="toggle-storm" style="flex:1; margin:0; text-align:center;" onclick="toggleSound('storm')">‚ö° Storm</div>
            <div class="sound-toggle" id="toggle-birds" style="flex:1; margin:0; text-align:center;" onclick="toggleSound('birds')">üê¶ Birdsong</div>
        </div>
        <div style="text-align: center; margin-top: 30px;">
            <div style="font-size: 4rem; font-weight: 800; letter-spacing: -2px;" id="timeDisplay">25:00</div>
            <div style="display: flex; gap: 10px; justify-content: center; margin-top: 20px;">
                <button onclick="toggleTimer()" id="timerBtn" style="background:var(--accent); color:var(--bg); border:none; padding:12px 30px; border-radius:30px; font-weight:bold;">Start Focus</button>
                <button onclick="resetTimer()" id="resetBtn" style="background:transparent; border:1px solid var(--border); color:var(--muted); padding:12px 20px; border-radius:30px; font-weight:bold; display: none;">Reset</button>
            </div>
        </div>
    </div>

    <div class="view">
        <h2 style="color: var(--accent); margin-top:0;">Inbox</h2>
        <div id="inbox-list"></div>
    </div>

    <div class="view">
        <h2 style="color: var(--yellow); margin-top:0;">Daily Focus</h2>
        <div id="focus-list"></div>
    </div>

    <div class="view">
        <h2 style="color: var(--muted); margin-top:0;">Completed Tasks</h2>
        <div class="archive-toolbar">
            <button class="tool-btn" onclick="exportToCSV()">üì§ Export tasks.csv</button>
            <label class="tool-btn-secondary">üì• Import tasks.csv <input type="file" id="csvFileInput" accept=".csv" onchange="importCSV(event)" style="display:none;"></label>
        </div>
        <div id="archive-list"></div>
    </div>
</div>

<div class="input-bar">
    <div class="input-box">
        <input type="text" id="taskInput" placeholder="New task..." autocomplete="off">
        <button onclick="addTask()" style="background:var(--accent); border:none; border-radius:12px; width:40px; height:40px; color:#020617; font-weight:bold;">+</button>
    </div>
</div>

<audio id="stormAudio" loop src="storm.mp3"></audio>
<audio id="birdsAudio" loop src="birdsong.mp3"></audio>
<audio id="pingAudio" src="https://assets.mixkit.co/active_storage/sfx/2571/2571-preview.mp3"></audio>
<audio id="bellAudio" src="https://assets.mixkit.co/active_storage/sfx/2568/2568-preview.mp3"></audio>

<script>
    /* Code by Neil Gibson */

    const quotes = [
        { q: "The only way to do great work is to love what you do.", a: "Steve Jobs" },
        { q: "The best time to plant a tree was 20 years ago. The second best time is now.", a: "Chinese Proverb" },
        { q: "Focus on being productive instead of busy.", a: "Tim Ferriss" },
        { q: "What we think, we become.", a: "Buddha" },
        { q: "Done is better than perfect.", a: "Sheryl Sandberg" }
    ];

    let tasks = JSON.parse(localStorage.getItem('Tasks') || '[]');
    let currentPane = 1; 
    let timerSeconds = 25 * 60;
    let timerInterval = null;
    const growthIcons = { 0: 'ü´ò', 25: 'üå±', 50: 'üåø', 75: 'ü™¥', 100: 'üå≥' };

    function initSplash() {
        const quote = quotes[Math.floor(Math.random() * quotes.length)];
        document.getElementById('splash-quote').innerText = `"${quote.q}"`;
        document.getElementById('splash-author').innerText = `‚Äî ${quote.a}`;
        setTimeout(() => {
            document.getElementById('splash-screen').classList.add('hidden');
        }, 2500);
    }

    function save() { 
        localStorage.setItem('Tasks', JSON.stringify(tasks)); 
        render(); 
    }

    function render() {
        const lists = { 
            inbox: document.getElementById('inbox-list'), 
            focus: document.getElementById('focus-list'), 
            archive: document.getElementById('archive-list') 
        };
        Object.values(lists).forEach(l => l.innerHTML = '');

        tasks.forEach(t => {
            const card = document.createElement('div');
            card.className = 'task-card';
            const icon = t.done ? 'üå≥' : (growthIcons[t.progress] || 'ü´ò');
            
            card.innerHTML = `
                <div class="growth-stage-icon" onclick="toggleFocus(${t.id})">${icon}</div>
                <div class="task-main">
                    <div class="task-name" style="${t.done ? 'text-decoration:line-through; opacity:0.6;' : ''}">${t.text}</div>
                    ${t.done ? `<div class="harvest-meta">Harvested ‚Ä¢ ${t.completedDate || ''}</div>` : ''}
                </div>
                ${!t.done ? `
                    <div class="growth-controls">
                        <button class="step-btn" onclick="adjustProgress(${t.id}, -1, this)" ${t.progress===0?'disabled':''}>‚àí</button>
                        <div class="percent-badge">${t.progress}%</div>
                        <button class="step-btn" onclick="adjustProgress(${t.id}, 1, this)" ${t.progress===100?'disabled':''}>+</button>
                    </div>
                ` : ''}
                <button class="del-btn" onclick="deleteTask(${t.id})">&times;</button>
            `;
            
            if(t.done) lists.archive.appendChild(card);
            else if(t.focus) lists.focus.appendChild(card);
            else lists.inbox.appendChild(card);
        });
    }

    function adjustProgress(id, dir, el) {
        const t = tasks.find(x => x.id === id);
        const steps = [0, 25, 50, 75, 100];
        let idx = steps.indexOf(t.progress) + dir;
        
        if (idx >= 0 && idx < steps.length) {
            t.progress = steps[idx];
            if (t.progress === 100) {
                t.done = true;
                t.completedDate = new Date().toLocaleDateString(undefined, { month: 'short', day: 'numeric' });
                document.getElementById('pingAudio').play().catch(()=>{});
                el.closest('.task-card').classList.add('ping-flash');
                setTimeout(save, 600);
            } else {
                t.done = false;
                delete t.completedDate;
                save();
            }
        }
    }

    function toggleFocus(id) { 
        const t = tasks.find(x => x.id === id); 
        if(!t.done) { t.focus = !t.focus; save(); } 
    }

    function addTask() { 
        const i = document.getElementById('taskInput'); 
        if(!i.value.trim()) return; 
        tasks.push({ 
            id: Date.now(), 
            text: i.value, 
            progress: 0, 
            done: false, 
            focus: currentPane === 2 
        }); 
        i.value = ''; 
        save(); 
    }

    function deleteTask(id) { 
        if(confirm("Delete this task?")) { 
            tasks = tasks.filter(t => t.id !== id); 
            save(); 
        } 
    }

    function toggleSound(s) { 
        const a = document.getElementById(s+'Audio'); 
        const btn = document.getElementById('toggle-'+s);
        if(a.paused) { a.play(); btn.classList.add('active'); }
        else { a.pause(); btn.classList.remove('active'); }
    }

    function updateTimerDisplay() {
        const m = Math.floor(timerSeconds/60), s = timerSeconds%60;
        document.getElementById('timeDisplay').innerText = `${m}:${s<10?'0':''}${s}`;
    }

    function toggleTimer() {
        const btn = document.getElementById('timerBtn'), resetBtn = document.getElementById('resetBtn');
        if (timerInterval) { 
            clearInterval(timerInterval); 
            timerInterval = null; 
            btn.innerText = 'Resume'; 
        } else {
            if (timerSeconds <= 0) timerSeconds = 25 * 60;
            btn.innerText = 'Pause'; 
            resetBtn.style.display = 'block';
            timerInterval = setInterval(() => {
                timerSeconds--; 
                updateTimerDisplay();
                if (timerSeconds <= 0) { 
                    clearInterval(timerInterval); 
                    timerInterval = null;
                    btn.innerText = 'Start Focus'; 
                    document.getElementById('bellAudio').play().catch(()=>{});
                    alert("Focus session complete!"); 
                }
            }, 1000);
        }
    }

    function resetTimer() {
        clearInterval(timerInterval); 
        timerInterval = null; 
        timerSeconds = 25 * 60;
        updateTimerDisplay(); 
        document.getElementById('timerBtn').innerText = 'Start Focus';
        document.getElementById('resetBtn').style.display = 'none';
    }

    function exportToCSV() {
        let csv = "id,text,progress,done,focus,completedDate\n";
        tasks.forEach(t => {
            csv += `${t.id},"${t.text.replace(/"/g, '""')}",${t.progress},${t.done},${t.focus},"${t.completedDate||''}"\n`;
        });
        const blob = new Blob([csv], { type: 'text/csv' });
        const url = URL.createObjectURL(blob);
        const link = document.createElement("a");
        link.href = url;
        link.download = `garden_tasks.csv`;
        link.click();
    }

    function importCSV(e) {
        const file = e.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = function(event) {
            try {
                const rows = event.target.result.split('\n').filter(r => r.trim());
                tasks = rows.slice(1).map(row => {
                    const p = row.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/).map(v => v.replace(/^"|"$/g, ''));
                    return {
                        id: parseInt(p[0]),
                        text: p[1],
                        progress: parseInt(p[2]),
                        done: p[3].trim() === 'true',
                        focus: p[4].trim() === 'true',
                        completedDate: p[5] || null
                    };
                });
                save();
            } catch(err) { alert("Format Error."); }
        };
        reader.readAsText(file);
    }

    const container = document.getElementById('screen-container');
    let startX = 0, isDragging = false;

    container.ontouchstart = (e) => {
        if (['BUTTON', 'INPUT', 'LABEL'].includes(e.target.tagName)) return;
        isDragging = true; startX = e.touches[0].pageX; container.style.transition = 'none';
    };

    window.ontouchmove = (e) => {
        if (!isDragging) return;
        const deltaX = e.touches[0].pageX - startX;
        const currentPosPercent = (currentPane * -25) + (deltaX / window.innerWidth * 25);
        container.style.transform = `translateX(${currentPosPercent}%)`;
    };

    window.ontouchend = (e) => {
        if (!isDragging) return;
        isDragging = false;
        const deltaX = e.changedTouches[0].pageX - startX;
        if (Math.abs(deltaX) > 60) {
            if (deltaX < 0 && currentPane < 3) currentPane++;
            else if (deltaX > 0 && currentPane > 0) currentPane--;
        }
        updateLayout();
    };

    function updateLayout() {
        container.style.transition = 'transform 0.5s cubic-bezier(0.16, 1, 0.3, 1)';
        container.style.transform = `translateX(${currentPane * -25}%)`;
        document.querySelectorAll('.dot').forEach((d, i) => d.classList.toggle('active', i === currentPane));
    }

    initSplash(); updateLayout(); render();
    document.getElementById('taskInput').addEventListener('keypress', (e) => { if(e.key === 'Enter') addTask(); });
</script>
</body>
</html>
